<%- include('../partials/_head', { title: 'Edit Transaction', styles: ['/styles/transactions.css'] }) %>
  <body>
    <%- include('../partials/_navbar') %>
    <main id="maincontent" class="container">
      <h1>Edit Transaction</h1>
      <form class="form" action="/transactions/<%= transaction._id %>?_method=PUT" method="post" data-validate="transaction">
        <% if (csrfToken) { %>
        <input type="hidden" name="_csrf" value="<%= csrfToken %>" />
        <% } %>
        <div class="form__row">
          <label for="title">Title</label>
          <input id="title" name="title" type="text" value="<%= transaction.title %>" required />
        </div>
        <% if (flash && flash.error) { %> <% flash.error.forEach(msg => { %>
        <div class="field-error" role="alert"><%= msg %></div>
        <% }) %> <% } %>
        <div class="form__row">
          <label for="amount">Amount</label>
          <input id="amount" name="amount" type="number" step="0.01" value="<%= transaction.amount %>" required />
        </div>
        <div class="form__row">
          <label for="date">Date</label>
          <input id="date" name="date" type="date" value="<%= transaction.date.toISOString().slice(0,10) %>" />
        </div>
        <div class="form__row">
          <label for="category">Category</label>
          <select id="category" name="category">
            <option value="">-- Choose category --</option>
            <% if (Array.isArray(categories)) { %>
              <% categories.forEach(cat => { %>
                <option value="<%= cat %>" <%= transaction.category === cat ? 'selected' : '' %>><%= cat %></option>
              <% }) %>
            <% } %>
          </select>
        </div>
        <div class="form__row">
          <label for="notes">Notes</label>
          <textarea id="notes" name="notes"><%= transaction.notes %></textarea>
        </div>
        <div class="form__actions">
          <button type="submit" class="btn btn--primary">Save</button>
          <a href="/transactions/<%= transaction._id %>" class="btn btn--secondary">Cancel</a>
        </div>
      </form>
    </main>
    <script src="/js/main.js" defer></script>
  </body>
</html>
